<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Receipt Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .receipt {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .button {
            background: #25D366;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .button:hover {
            background: #128C7E;
        }

        .phone-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            width: 200px;
        }
    </style>
</head>

<body>
    <h1>WhatsApp Receipt Test</h1>

    <div class="receipt">
        <h2>Sample Order Receipt</h2>
        <p><strong>Betty Organic</strong><br>
            Fresh Organic Fruits & Vegetables</p>

        <p><strong>Order ID:</strong> BO-TEST-001<br>
            <strong>Customer:</strong> Test Customer<br>
            <strong>Date:</strong> June 13, 2025
        </p>

        <hr>

        <p><strong>Items:</strong></p>
        <ul>
            <li>Orange (1000g) - ETB 350.00</li>
            <li>Eggplant (1000g) - ETB 150.00</li>
            <li>Green chille (1000g) - ETB 200.00</li>
        </ul>

        <hr>
        <p><strong>Total: ETB 700.00</strong></p>
    </div>

    <div>
        <h3>Test WhatsApp Receipt</h3>
        <input type="text" id="phoneNumber" class="phone-input" placeholder="+251944113998" value="+251944113998">
        <br>
        <button class="button" onclick="sendWhatsAppReceipt()">
            📱 Send to WhatsApp
        </button>
    </div>

    <script>
        function generateReceiptText() {
            const storeName = "Betty Organic";
            const orderId = "BO-TEST-001";
            const customerName = "Test Customer";
            const items = [
                { name: "Orange", quantity: 1, price: 350.00 },
                { name: "Eggplant", quantity: 1, price: 150.00 },
                { name: "Green chille", quantity: 1, price: 200.00 }
            ];
            const total = 700.00;

            const currentDate = new Date();
            const orderDate = currentDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const orderTime = currentDate.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });

            let text = `🧾 *${storeName} - Order Receipt*\n`;
            text += `🌿 Fresh Organic Fruits & Vegetables 🌿\n`;
            text += `${'═'.repeat(35)}\n\n`;

            text += `👤 *Customer:* ${customerName}\n`;
            text += `📋 *Order ID:* ${orderId}\n`;
            text += `📅 *Date:* ${orderDate}\n`;
            text += `🕒 *Time:* ${orderTime}\n\n`;

            text += `${'─'.repeat(35)}\n`;
            text += `📦 *ORDER ITEMS*\n`;
            text += `${'─'.repeat(35)}\n`;

            let subtotal = 0;
            items.forEach((item, index) => {
                const itemTotal = item.price;
                subtotal += itemTotal;
                text += `${index + 1}. *${item.name}*\n`;
                text += `   📏 ${(item.quantity * 1000).toFixed(0)}g\n`;
                text += `   💰 ETB ${itemTotal.toFixed(2)}\n\n`;
            });

            text += `${'─'.repeat(35)}\n`;
            text += `💵 *PAYMENT SUMMARY*\n`;
            text += `${'─'.repeat(35)}\n`;
            text += `Subtotal: ETB ${subtotal.toFixed(2)}\n`;
            text += `Delivery: ETB 0.00\n`;
            text += `Discount: ETB 0.00\n`;
            text += `${'─'.repeat(20)}\n`;
            text += `*TOTAL: ETB ${total.toFixed(2)}*\n\n`;

            text += `${'═'.repeat(35)}\n`;
            text += `✅ *Order Confirmed!*\n\n`;
            text += `🚚 We'll prepare your fresh organic produce\n`;
            text += `📞 We'll contact you for delivery coordination\n\n`;
            text += `💚 Thank you for choosing Betty Organic!\n`;
            text += `🌱 Supporting healthy living & sustainable farming\n\n`;
            text += `📱 Questions? Reply to this message\n`;
            text += `🌐 Visit: ${window.location.origin}`;

            return encodeURIComponent(text);
        }

        function sendWhatsAppReceipt() {
            const phoneNumber = document.getElementById('phoneNumber').value;

            if (!phoneNumber) {
                alert('Please enter a phone number');
                return;
            }

            // Validate Ethiopian phone number format
            const cleanPhone = phoneNumber.replace(/[\s\-\(\)]/g, '');
            const phoneRegex = /^\+251\d{9}$/;

            if (!phoneRegex.test(cleanPhone)) {
                alert('Please enter a valid Ethiopian phone number (e.g., +251944113998)');
                return;
            }

            const text = generateReceiptText();
            const url = `https://wa.me/${cleanPhone.replace('+', '')}?text=${text}`;

            console.log('Opening WhatsApp URL:', url);
            window.open(url, "_blank");

            setTimeout(() => {
                alert(`Receipt sent to WhatsApp: ${phoneNumber}`);
            }, 1000);
        }
    </script>
</body>

</html>